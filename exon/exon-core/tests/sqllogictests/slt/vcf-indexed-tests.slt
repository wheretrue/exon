control substitution on

statement ok
CREATE EXTERNAL TABLE indexed_vcf_table STORED AS INDEXED_VCF COMPRESSION TYPE GZIP LOCATION '$CARGO_MANIFEST_DIR/test-data/datasources/vcf/index.vcf.gz'

# If we try to select from a statement w/o a region filter we should get an error.
statement error
SELECT * FROM indexed_vcf_table;

# If we try to select from a statement w/ a region filter we should not get an error.
statement ok
SELECT * FROM indexed_vcf_table WHERE vcf_region_filter('1', chrom) = true;

# Clean up after the test
statement ok
DROP TABLE indexed_vcf_table;

statement ok
CREATE EXTERNAL TABLE vcf_table STORED AS INDEXED_VCF PARTITIONED BY (sample) COMPRESSION TYPE GZIP LOCATION '$CARGO_MANIFEST_DIR/test-data/datasources/vcf-partition';

query T
SELECT chrom, sample, COUNT(*) AS cnt FROM vcf_table WHERE vcf_region_filter('1', chrom) = true AND sample = '1' GROUP BY chrom, sample ORDER BY chrom, sample;
----
1 1 191

statement ok
DROP TABLE vcf_table;
